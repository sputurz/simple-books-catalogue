(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();const E=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.6667 9.33333C13.66 8.36 14.6667 7.19333 14.6667 5.66667C14.6667 4.69421 14.2804 3.76158 13.5928 3.07394C12.9051 2.38631 11.9725 2 11 2C9.82671 2 9.00004 2.33333 8.00004 3.33333C7.00004 2.33333 6.17337 2 5.00004 2C4.02758 2 3.09495 2.38631 2.40732 3.07394C1.71968 3.76158 1.33337 4.69421 1.33337 5.66667C1.33337 7.2 2.33337 8.36667 3.33337 9.33333L8.00004 14L12.6667 9.33333Z" stroke="currentColor" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`;class S{constructor(e,t,a=!1){this.cardData=e,this.onLikeToggle=t,this.isSmall=a,this.element=this.createElement()}createElement(){const e=document.createElement("div");e.className=`card ${this.isSmall?"card--small":""}`;const t=document.createElement("a");t.className="card__link",t.href=`https://openlibrary.org${this.cardData.key}}`,t.ariaLabel="Link to book",t.target="_blank",t.rel="noopener noreferrer";const a=document.createElement("img");a.className="card__img",a.src=this.cardData.cover,a.alt=this.cardData.title;const o=document.createElement("div");o.className="card__wrap";const n=document.createElement("p");n.className="card__title",n.textContent=this.cardData.title;const c=document.createElement("p");c.className="card__author",c.textContent=this.cardData.author;const s=document.createElement("span");s.className="card__year",s.textContent=this.cardData.year;const i=document.createElement("button");return i.className=`card__btn ${this.cardData.isFavorite?" card__btn--favorite":""}`,i.type="button",i.ariaLabel=this.cardData.isFavorite?"Delete":"Add",i.title=this.cardData.isFavorite?"Delete":"Add",i.onclick=()=>this.onLikeToggle(this.cardData.key),e.append(t,i),t.append(a,o),o.append(n,c,s),i.innerHTML=E,e}update(e){this.cardData=e;const t=this.element.querySelector("button");t.className=`card__btn ${this.cardData.isFavorite?" card__btn--favorite":""}`,t.ariaLabel=this.cardData.isFavorite?"Delete":"Add",t.title=this.cardData.isFavorite?"Delete":"Add"}getElement(){return this.element}}class I{constructor(e,t,a=!1){this.container=e,this.onLikeToggle=t,this.itemsMap=new Map,this.isLikeList=a,this.ulEl=document.createElement("ul"),this.ulEl.className=`card-list ${this.isLikeList?"card-list--favorite":""}`,this.container.appendChild(this.ulEl)}addItem(e){if(this.itemsMap.has(e.key))return;const t=new S(e,this.onLikeToggle,this.isLikeList),a=document.createElement("li");a.className="card-list__item",a.dataset.key=e.key,a.appendChild(t.getElement()),this.ulEl.appendChild(a),this.itemsMap.set(e.key,{card:t,liEl:a})}removeItem(e){const t=this.itemsMap.get(e);t&&(t.liEl.remove(),this.itemsMap.delete(e))}updateItem(e){const t=this.itemsMap.get(e.key);t&&t.card.update(e)}hasItem(e){return this.itemsMap.has(e)}getKeys(){return Array.from(this.itemsMap.keys())}}function w(r,e,t){const a=new I(r,t,!0);function o(s,i){e.textContent=i.length,s.forEach(u=>{a.addItem(u)})}function n(s){a.addItem(s)}function c(s){a.removeItem(s)}return{renderFavoriteList:o,addFavoriteItem:n,removeFavoriteItem:c,getElement:()=>a}}const b="https://openlibrary.org";function _(r){if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`)}async function M(r){try{const e=await fetch(b+"/search.json?q="+r.replace(/ /g,"+"));_(e);const t=await e.json();return t.docs?t.docs:[]}catch(e){throw console.error(e),e}}async function N(r){try{const e=await fetch(`${b}${r}.json`);_(e);const t=await e.json();return t||null}catch(e){return console.error(e),null}}async function D(r){try{const e=await fetch(`${b}${r}.json`);_(e);const t=await e.json();return t?t.name:""}catch(e){console.error(e)}}async function Z(r){try{let e="";for(let t=0;t<r.length;t++){const a=await D(r[t].author.key);a&&(e+=a+", ")}return e.slice(0,-2)}catch(e){console.error(e)}}const k="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHZpZXdCb3g9IjAgMCAyMDAgMzAwIj48cGF0aCBmaWxsPSJncmF5IiBkPSJNMCAwaDIwMHYzMDBIMHoiLz48dGV4dCB4PSIxMDAiIHk9IjE1MCIgZmlsbD0iI2ZmZiIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjI0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5ObyBjb3ZlcjwvdGV4dD48L3N2Zz4=",h="no info",F="https://covers.openlibrary.org/b/id/{cover}-M.jpg";function j(r,e,t){e.length=0;for(let a=0;a<r.length;a++){const o=r[a];e.push({key:o.key,title:o.title||h,author:o.author_name?.length?o.author_name.join(", "):h,year:o.first_publish_year||h,cover:o.cover_i?F.replace("{cover}",o.cover_i):k,isFavorite:t.includes(o.key)})}return e}async function x(r){return{key:r.key,title:r.title||h,author:r.authors?await Z(r.authors):r.by_statement||h,year:r.publish_date||r.first_publish_date||h,cover:r.covers?.length?F.replace("{cover}",r.covers[0]):k,isFavorite:!0}}function A(r,e,t,a,o,n){let c="";async function s(){const i=r.value.trim();if(t.classList.remove("search__info--result"),t.classList.remove("search__info--error"),i){if(i===c)return}else{t.classList.add("search__info--result"),t.textContent="Empty request";return}e.disabled=!0,r.disabled=!0,e.textContent="Loading...";try{const u=await M(i);if(!u||u.length===0){n("No books found");return}const y=j(u,[],a);o(y),c=i}catch(u){console.error(u),n(`Error: ${u}`)}finally{e.disabled=!1,r.disabled=!1,e.textContent="Search"}}e.addEventListener("click",s)}function T(r,e){const t=new I(r,e);function a(n){const c=n.map(s=>s.key);t.getKeys().forEach(s=>{c.includes(s)||t.removeItem(s)}),n.forEach(s=>{t.hasItem(s.key)?t.updateItem(s):t.addItem(s)})}function o(n){t.updateItem(n)}return{renderSearchList:a,updateSearchListItem:o,getElement:()=>t}}const C="favorite-keys",L=[],v=r=>{try{localStorage.setItem(C,JSON.stringify(r))}catch(e){console.error("Failed to save item",e)}},$=()=>{try{const r=localStorage.getItem(C);return r?JSON.parse(r):L}catch(r){return console.error("Failed to load item",r),v(L),L}};async function q(r){const e=[];let t=!1;for(let a=0;a<r.length;a++){const o=await N(r[a]);o?e.push(await x(o)):t=!0}return t&&(r=e.map(a=>a.key),v(r)),e}const W=async()=>{const r=document.querySelector(".search__input"),e=document.querySelector(".search__btn"),t=document.querySelector(".search__info"),a=document.querySelector(".main-page__search-list"),o=document.querySelector(".favorites__qty"),n=document.querySelector(".favorites__card-list-wrap");let c=[],s=$(),i=await q(s);function u(l){const m=c.find(d=>d.key===l);m&&(m.isFavorite=!m.isFavorite,m.isFavorite?(i.push(m),s.push(l),p.addFavoriteItem(m)):(i=i.filter(d=>d.key!==l),s=s.filter(d=>d!==l),p.removeFavoriteItem(l)),v(s),o.textContent=s.length,g.updateSearchListItem(m))}function y(l){if(i.find(d=>d.key===l)){const d=c.find(f=>f.key===l);d&&(d.isFavorite=!1,g.updateSearchListItem(d)),i=i.filter(f=>f.key!==l),s=s.filter(f=>f!==l),v(s),o.textContent=s.length,p.removeFavoriteItem(l)}}const g=T(a,u),p=w(n,o,y);A(r,e,t,s,l=>{c=l,g.renderSearchList(c)},l=>{t.classList.add("search__info--error"),t.textContent=l}),p.renderFavoriteList(i,s)};document.addEventListener("DOMContentLoaded",()=>{W()});
