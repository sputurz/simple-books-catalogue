(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}})();const M=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.6667 9.33333C13.66 8.36 14.6667 7.19333 14.6667 5.66667C14.6667 4.69421 14.2804 3.76158 13.5928 3.07394C12.9051 2.38631 11.9725 2 11 2C9.82671 2 9.00004 2.33333 8.00004 3.33333C7.00004 2.33333 6.17337 2 5.00004 2C4.02758 2 3.09495 2.38631 2.40732 3.07394C1.71968 3.76158 1.33337 4.69421 1.33337 5.66667C1.33337 7.2 2.33337 8.36667 3.33337 9.33333L8.00004 14L12.6667 9.33333Z" stroke="currentColor" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`;class N{constructor(e,t,s=!1){this.cardData=e,this.onLikeToggle=t,this.isSmall=s,this.element=this.createElement()}createElement(){const e=document.createElement("div");e.className=`card ${this.isSmall?"card--small":""}`;const t=document.createElement("a");t.className="card__link",t.href=`https://openlibrary.org${this.cardData.key}}`,t.ariaLabel="Link to book",t.target="_blank",t.rel="noopener noreferrer";const s=document.createElement("img");s.className="card__img",s.src=this.cardData.cover,s.alt=this.cardData.title;const a=document.createElement("div");a.className="card__wrap";const n=document.createElement("p");n.className="card__title",n.textContent=this.cardData.title;const d=document.createElement("p");d.className="card__author",d.textContent=this.cardData.author;const u=document.createElement("span");u.className="card__year",u.textContent=this.cardData.year;const i=document.createElement("button");return i.className=`card__btn ${this.cardData.isFavorite?" card__btn--favorite":""}`,i.type="button",i.ariaLabel=this.cardData.isFavorite?"Delete":"Add",i.title=this.cardData.isFavorite?"Delete":"Add",i.onclick=()=>this.onLikeToggle(this.cardData.key),e.append(t,i),t.append(s,a),a.append(n,d,u),i.innerHTML=M,e}update(e){this.cardData=e;const t=this.element.querySelector("button");t.className=`card__btn ${this.cardData.isFavorite?" card__btn--favorite":""}`,t.ariaLabel=this.cardData.isFavorite?"Delete":"Add",t.title=this.cardData.isFavorite?"Delete":"Add"}getElement(){return this.element}}class E{constructor(e,t,s=!1){this.container=e,this.onLikeToggle=t,this.itemsMap=new Map,this.isLikeList=s,this.ulEl=document.createElement("ul"),this.ulEl.className=`card-list ${this.isLikeList?"card-list--favorite":""}`,this.container.appendChild(this.ulEl)}addItem(e){if(this.itemsMap.has(e.key))return;const t=new N(e,this.onLikeToggle,this.isLikeList),s=document.createElement("li");s.className="card-list__item",s.dataset.key=e.key,s.appendChild(t.getElement()),this.ulEl.appendChild(s),this.itemsMap.set(e.key,{card:t,liEl:s})}removeItem(e){const t=this.itemsMap.get(e);t&&(t.liEl.remove(),this.itemsMap.delete(e))}updateItem(e){const t=this.itemsMap.get(e.key);t&&t.card.update(e)}hasItem(e){return this.itemsMap.has(e)}getKeys(){return Array.from(this.itemsMap.keys())}}const g="https://openlibrary.org";function v(r){if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`)}async function S(r){try{const e=await fetch(g+"/search.json?q="+r.replace(/ /g,"+"));v(e);const t=await e.json();return t.docs?t.docs:[]}catch(e){throw console.log(e),e}}async function D(r){try{const e=await fetch(`${g}${r}.json`);v(e);const t=await e.json();return t||null}catch(e){return console.log(e),null}}async function Z(r){try{const e=await fetch(`${g}${r}.json`);v(e);const t=await e.json();return t?t.name:""}catch(e){console.log(e)}}async function j(r){try{let e="";for(let t=0;t<r.length;t++){const s=await Z(r[t].author.key);s&&(e+=s+", ")}return e.slice(0,-2)}catch(e){console.log(e)}}const L="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHZpZXdCb3g9IjAgMCAyMDAgMzAwIj48cGF0aCBmaWxsPSJncmF5IiBkPSJNMCAwaDIwMHYzMDBIMHoiLz48dGV4dCB4PSIxMDAiIHk9IjE1MCIgZmlsbD0iI2ZmZiIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjI0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5ObyBjb3ZlcjwvdGV4dD48L3N2Zz4=",m="no info",I="https://covers.openlibrary.org/b/id/{cover}-M.jpg";function x(r,e,t){e.length=0;for(let s=0;s<r.length;s++){const a=r[s];e.push({key:a.key,title:a.title||m,author:a.author_name?.length?a.author_name.join(", "):m,year:a.first_publish_year||m,cover:a.cover_i?I.replace("{cover}",a.cover_i):L,isFavorite:t.includes(a.key)})}return e}async function A(r){return{key:r.key,title:r.title||m,author:r.authors?await j(r.authors):r.by_statement||m,year:r.publish_date||r.first_publish_date||m,cover:r.covers?.length?I.replace("{cover}",r.covers[0]):L,isFavorite:!0}}const C="favorite-keys",y=[],_=r=>{try{localStorage.setItem(C,JSON.stringify(r))}catch(e){console.error("Failed to save item",e)}},$=()=>{try{const r=localStorage.getItem(C);return r?JSON.parse(r):y}catch(r){return console.error("Failed to load item",r),_(y),y}};async function q(r){const e=[];let t=!1;for(let s=0;s<r.length;s++){const a=await D(r[s]);a?e.push(await A(a)):t=!0}return t&&(r=e.map(s=>s.key),_(r)),e}const T=async()=>{const r=document.querySelector(".search__input"),e=document.querySelector(".search__btn"),t=document.querySelector(".search__info"),s=document.querySelector(".main-page__search-list"),a=document.querySelector(".favorites__qty"),n=document.querySelector(".favorites__card-list-wrap");let d="",u=[],i=$(),f=await q(i);function b(c){const l=u.find(o=>o.key===c);l&&(l.isFavorite=!l.isFavorite,l.isFavorite?(f.push(l),i.push(c)):(f=f.filter(o=>o.key!==c),i=i.filter(o=>o!==c)),_(i),a.textContent=i.length,h.updateItem(l),l.isFavorite?p.addItem(l):p.removeItem(c))}async function k(c){const l=r.value.trim();if(t.classList.remove("search__info--result"),t.classList.remove("search__info--error"),l){if(l===d)return}else{t.classList.add("search__info--result"),t.textContent="Empty request";return}e.disabled=!0,r.disabled=!0,e.textContent="Loading...";try{const o=await S(l);if(!o||o.length===0){t.classList.add("search__info--error"),t.textContent="No books found";return}c=x(o,c,i),F(c),d=l,console.log(c)}catch(o){console.error(o),t.classList.add("search__info--error"),t.textContent=`Error: ${o}`}finally{e.disabled=!1,r.disabled=!1,e.textContent="Search"}}function w(){a.textContent=i.length,f.forEach(c=>{p.addItem(c)})}function F(c){const l=c.map(o=>o.key);h.getKeys().forEach(o=>{l.includes(o)||h.removeItem(o)}),c.forEach(o=>{h.hasItem(o.key)?h.updateItem(o):h.addItem(o)})}const h=new E(s,b),p=new E(n,b,!0);e.addEventListener("click",()=>{k(u)}),w()};document.addEventListener("DOMContentLoaded",()=>{T()});
